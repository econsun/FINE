\immediate\write18{makeindex \jobname.idx}

\documentclass[a4paper,11pt]{book}
\usepackage[bindingoffset=1cm,top=2cm,bottom=2cm,left=2cm,right=2cm]{geometry}
\usepackage[super,square,comma,sort&compress]{natbib}

% 设置中文
\usepackage{xeCJK}
\setCJKmainfont{SimSun}[BoldFont=SimHei,ItalicFont=AR PL KaitiM GB]
\usepackage{CJKnumb}
\usepackage{zhnumber}

% 设置英文
\usepackage[T1]{fontenc}
\usepackage{anyfontsize}

% 基本设置
\usepackage{indentfirst}
\setlength\parindent{2em}
\usepackage{setspace}
\lineskip = 5pt
\lineskiplimit = 5pt

% 排版宏包
\usepackage[clearempty]{titlesec}
\usepackage{titletoc,titleps}
\usepackage{ifthen}
\usepackage{makeidx}
\makeindex

% 设置 enumerate
\usepackage{enumitem}
\setenumerate[1]{label=\textendash,itemsep=5pt,parsep=0\parskip,topsep=0pt}
\setitemize[1]{itemsep=5pt,partopsep=0pt,parsep=\parskip,topsep=5pt}
\setdescription{itemsep=5pt,partopsep=0pt,parsep=\parskip,topsep=5pt}

% 图表宏包
\usepackage{graphicx}
\usepackage{subfig}
\usepackage{caption}
\usepackage{bicaption}
\usepackage{array}
\usepackage{booktabs}
\usepackage{threeparttable}
\usepackage{makecell}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{float}
\usepackage{paracol}
\usepackage{balance}
\usepackage[most]{tcolorbox}

\definecolor{browna}{rgb}{0.76,0.72,0.65}
\newtcbtheorem[no counter]{definition}{定义}{
    enhanced,
    sharp corners,
    attach boxed title to top left={
        yshifttext=-1mm
    },
    colback=white,
    colframe=browna,
    fonttitle=\bfseries,
    boxed title style={
        sharp corners,
        size=small,
        colback=browna,
        colframe=browna,
    } 
}{thm}

\definecolor{brownb}{rgb}{0.39,0.77,0.82}
\newtcbtheorem[no counter]{ramble}{漫谈}{
    enhanced,
    sharp corners,
    attach boxed title to top left={
        yshifttext=-1mm
    },
    colback=white,
    colframe=brownb,
    fonttitle=\bfseries,
    boxed title style={
        sharp corners,
        size=small,
        colback=brownb,
        colframe=brownb,
    } 
}{thm}

% 数学宏包
\usepackage{amsmath,bm}
\usepackage{amssymb}
\usepackage{esint}
\usepackage{amscd}
\usepackage{amsfonts}
\usepackage{mathrsfs}
\usepackage{oplotsymbl}
\usepackage{mathtools}
\usepackage{siunitx}
\usepackage{upgreek}
\usepackage{ntheorem}
\usepackage{empheq}

% 绘图宏包
\usepackage{animate}
\usepackage{tikz,pgf}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{shadings}
\usetikzlibrary{backgrounds}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.symbols}
\usetikzlibrary{shapes.arrows}
\usetikzlibrary{shapes.multipart}
\usetikzlibrary{calc}
\usetikzlibrary{math}
\usetikzlibrary{angles}
\usetikzlibrary{quotes} %angles加文字注释
\usetikzlibrary{positioning}
\usetikzlibrary{decorations.pathmorphing,decorations.markings,decorations.shapes}
\usetikzlibrary{patterns,patterns.meta}
\usetikzlibrary{3d}
\usetikzlibrary{perspective}
\usetikzlibrary{through}
\usetikzlibrary{intersections}
\usetikzlibrary{matrix}
\usetikzlibrary{mindmap}
\usetikzlibrary{circuits.ee,circuits.ee.IEC,circuits.logic.IEC}
\usepackage{tikz-3dplot}
\usepackage{pgfplots}

% 超链接宏包
\usepackage[unicode,bookmarks,bookmarksnumbered,colorlinks,linkcolor=blue]{hyperref}%超链接

% 设置顶部对齐
\raggedbottom

% 开始文档
\begin{document}
\begin{spacing}{1.5}

% 设置图表公式编号格式
% \captionsetup[figure]{name=图, labelsep=space}
\renewcommand{\thefigure}{\arabic{chapter}-\arabic{figure}}
% \captionsetup[table]{name=表, labelsep=space}
\renewcommand{\thetable}{\arabic{chapter}-\arabic{table}}
\renewcommand{\theequation}{\arabic{chapter}-\arabic{equation}}

% 改为中文样式
\renewcommand{\bibname}{参考文献}
\renewcommand{\figurename}{图}
\renewcommand{\tablename}{表}
\renewcommand{\chaptername}{第\CJKnumber{\thechapter}章}

% 设置前言页眉
\newpagestyle{mypre}{
\sethead[\chaptertitle][][]
{}{}{\chaptertitle}
\setfoot[][\thepage][]{}{\thepage}{}
}

% 设置正文页眉页脚
\newpagestyle{main}{
\sethead[\thesection~\sectiontitle][][FINE]
{FINE}{}{\thesection~\sectiontitle}
\headrule
\setfoot[][\thepage][]{}{\thepage}{}
}

\newpagestyle{back}{
\sethead[\chaptertitle][][FINE]
{FINE}{}{\chaptertitle}
\headrule
\setfoot[][\thepage][]{}{\thepage}{}
}


% 压缩空白页
\setboolean{@twoside}{false}

% 开始前言
\frontmatter

\newcommand{\tm}{\fontspec{Times New Roman}}
\title{\huge\tm A Fantastic Intermediate Note on Economics\\\huge{(\,FINE, Wish Your Life Be Fine\,)}}
\author{\LARGE{\tm Paul Sun}}
\date{\LARGE\tm \today}
\maketitle

% 定义前页部分章起始格式
\titleformat{\chapter}[hang]{\Huge\bfseries\filcenter}{\chaptername}{1em}{}
\titleformat*{\section}{\huge\bfseries\filleft}
\titleformat*{\subsection}{\Large\bfseries}

% 修改前言和目录的页面样式
\thispagestyle{empty}
\input{0-preface}

% 从前言开始计算页码
\pagenumbering{Roman}
\setcounter{page}{0}

% 添加前页格式
\pagestyle{mypre}

\renewcommand{\contentsname}{目录\label{here}}	
\tableofcontents
\titlecontents{chapter}[0em]{}{\bf}{}{\titlerule*[0.5pc]{.}\contentspage[\pageref{here}]}
\addcontentsline{toc}{chapter}{目录}

\titlecontents{chapter}[1.5em]{}{\color{blue}\bf\contentslabel{1.5em}}{}{\titlerule*[0.5pc]{.}\contentspage[\pageref{here}]}

% 开始正文
\mainmatter
\setboolean{@twoside}{true}

\pagestyle{main}

% 增加段间距
% \setlength{\parskip}{0.5\baselineskip}

\input{11-EquilibriumTheory}
\input{12-ConsumerTheory}
\input{13-ProducerTheory}
\input{14-MarketTheory}
\input{15-WelfareTheory}
\input{16-FactorTheory}
\input{17-GameTheory}
\input{18-MarketFailure}
\input{21-EconomicData}
\input{22-LongTermEconomics}
\input{23-UltraLongTermEconomics}
\input{24-ShortEconomics}
\input{25-OpenEconomics}
\input{26-MacroPolicy}
\input{27-MicroFoundation}
\input{28-SchoolnEvent}

% 增加段间距
\setlength{\parskip}{0\baselineskip}


% 开始附录
\backmatter
%\setboolean{bookmarksnumbered}{false}
%\titlecontents{chapter}[0em]{\bf}{}{}{\titlerule*[]{}\contentspage}

\balance
\printindex
\addcontentsline{toc}{chapter}{索引}

\clearpage
\end{spacing}
\end{document}